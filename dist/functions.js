!function(){function e(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,s=e},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw s}}}}function r(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function t(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function n(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?t(Object(n),!0).forEach((function(r){a(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function a(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function i(e,r,t,n,a,i,s){try{var o=e[i](s),u=o.value}catch(e){return void t(e)}o.done?r(u):Promise.resolve(u).then(n,a)}function s(e){return function(){var r=this,t=arguments;return new Promise((function(n,a){var s=e.apply(r,t);function o(e){i(s,n,a,o,u,"next",e)}function u(e){i(s,n,a,o,u,"throw",e)}o(void 0)}))}}function o(e,r){return u.apply(this,arguments)}function u(){return u=s(regeneratorRuntime.mark((function e(r,t){var a,i,s,o,u,c,p,l,b,f,d,m,h,g,k=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=k.length>2&&void 0!==k[2]?k[2]:void 0,i=k.length>3&&void 0!==k[3]?k[3]:void 0,null==a&&(a=void 0),null==i&&(i=void 0),s=readCookie("finsheet_api_key"),o=a,u=r,s){e.next=9;break}return e.abrupt("return",[["Please login using the sidebar"]]);case 9:if(u){e.next=11;break}return e.abrupt("return",[["Symbol cannot be empty"]]);case 11:if("string"==typeof u){e.next=13;break}return e.abrupt("return",[["Symbol has to be a string"]]);case 13:if(!u.includes(",")&&!u.includes(";")){e.next=15;break}return e.abrupt("return",["Invalid symbol"]);case 15:if(u=u.toUpperCase(),t){e.next=18;break}return e.abrupt("return",[["Metric cannot be empty"]]);case 18:if((t=t.toLowerCase())in map_excel_name_to_id||["bs","cf","ic"].includes(t)){e.next=21;break}return e.abrupt("return",[["Unsupported metric"]]);case 21:if(""===o&&(o=void 0),"string"==typeof o||void 0===o){e.next=24;break}return e.abrupt("return",[["Period has to be a string"]]);case 24:if(""===i&&(i=void 0),"number"==typeof i||void 0===i){e.next=27;break}return e.abrupt("return",[["Limit has to be a positive interger"]]);case 27:if(!(void 0!==i&&i<=0)){e.next=29;break}return e.abrupt("return",[["Limit has to be a positive interger"]]);case 29:if(c=t in map_excel_name_to_id?map_excel_name_to_id[t]:t,p=["bs","cf","ic"].includes(c),void 0!==o||!p&&!map_metrics[c].default_freq){e.next=35;break}o=["cf","ic"].includes(c)?"TTM":"bs"===c?"Q":map_metrics[c].default_freq,e.next=48;break;case 35:if(p||map_metrics[c].default_freq||void 0===o){e.next=39;break}return e.abrupt("return",[["This metric does not support periods"]]);case 39:if(void 0===o){e.next=48;break}if(o=o.toUpperCase(),!["bs","ic"].includes(c)||!o.includes("YTD")){e.next=43;break}return e.abrupt("return",[["Period YTD is only available for cf"]]);case 43:if("bs"!==c||!o.includes("TTM")){e.next=45;break}return e.abrupt("return",[["Period TTM is only available for ic and cf"]]);case 45:if(p?(l="cf"===c?["FY","TTM","Q","YTD"]:"bs"===c?["FY","Q"]:["FY","TTM","Q"],o=isValidFreq_returnCleanString(o,l,"TTM",c)):o=!!map_metrics[c].default_freq&&isValidFreq_returnCleanString(o,map_metrics[c].supported_freq,map_metrics[c].default_freq,c),!1!==o){e.next=48;break}return e.abrupt("return",[["Invalid period"]]);case 48:return!p&&["TTM","FY","Q","YTD"].includes(o)&&i&&i>1?o+="@"+i:p||(i=void 0),b={},p||(f={field_code:c},"-1"!==o&&""!==o&&void 0!==o&&(f.period=o),b=generate_query(1,"watchlist",[],[f],[],["",""],u,[f],[u])),b=n(n({},b),{ticker:u,metric:c,freq:o,api_key:s,limit:i,is_full_statement:p?"y":"n"}),206==c&&(b.is_latest_price="1"),d=link+"/excel/standard?"+new URLSearchParams(b).toString(),e.next=56,fetch(d);case 56:if((m=e.sent).ok){e.next=69;break}return e.next=60,m.text();case 60:return h=e.sent,console.log("err",h),e.prev=62,e.abrupt("return",[[JSON.parse(h).error]]);case 66:return e.prev=66,e.t0=e.catch(62),e.abrupt("return",[["Rate limit reached. Please try again later."]]);case 69:return e.next=71,m.json();case 71:if(g=e.sent,console.log(m,g),!("message"in g)){e.next=75;break}return e.abrupt("return",[[g.message]]);case 75:return e.abrupt("return",handle_receive_AR_EQUITY(g,p,c));case 76:case"end":return e.stop()}}),e,null,[[62,66]])}))),u.apply(this,arguments)}function c(){return c=s(regeneratorRuntime.mark((function e(r,t){var n,a,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>2&&void 0!==i[2]?i[2]:void 0,a=i.length>3&&void 0!==i[3]?i[3]:void 0,t){e.next=4;break}return e.abrupt("return",[["Metric cannot be empty"]]);case 4:if((t=t.toLowerCase())in map_excel_name_to_id){e.next=7;break}return e.abrupt("return",[["Unsupported metric"]]);case 7:if(r){e.next=9;break}return e.abrupt("return",[[""]]);case 9:return e.abrupt("return",o(r,t,n,a));case 10:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function p(){return p=s(regeneratorRuntime.mark((function e(r,t){var n,a,i,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>2&&void 0!==s[2]?s[2]:void 0,a=s.length>3&&void 0!==s[3]?s[3]:void 0,i=t){e.next=5;break}return e.abrupt("return",[["Metric cannot be empty"]]);case 5:if(i=i.toLowerCase(),["bs","cf","ic"].includes(i)){e.next=8;break}return e.abrupt("return",[["Unsupported metric"]]);case 8:return e.abrupt("return",o(r,i,n,a));case 9:case"end":return e.stop()}}),e)}))),p.apply(this,arguments)}var l={1:1,5:1,15:1,30:1,60:1,D:1,W:1,M:1,d:1,w:1,m:1},b={d:1,w:1,m:1},f=["close","open","high","low","volume"];function d(e,r,t){return m.apply(this,arguments)}function m(){return m=s(regeneratorRuntime.mark((function e(r,t,n){var a,i,s,o,u,c,p,d,m,h,g,k,y=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=y.length>3&&void 0!==y[3]?y[3]:void 0,i=y.length>4&&void 0!==y[4]?y[4]:"stock",null==a&&(a=void 0),console.log(n,a),s=readCookie("finsheet_api_key")){e.next=7;break}return e.abrupt("return",[["Please login using the sidebar"]]);case 7:if(r){e.next=9;break}return e.abrupt("return",[["Symbol cannot be empty"]]);case 9:if("string"==typeof r){e.next=11;break}return e.abrupt("return",[["Symbol has to be a string"]]);case 11:if(!r.includes(",")&&!r.includes(";")){e.next=13;break}return e.abrupt("return",["Invalid symbol"]);case 13:if(r=r.toUpperCase(),t in l){e.next=16;break}return e.abrupt("return",[["Invalid resolution"]]);case 16:if(t in b&&(t=t.toUpperCase()),o=Date.parse(new Date)/1e3,n){e.next=20;break}return e.abrupt("return",[["'from' cannot be empty"]]);case 20:if("number"!=typeof n&&isNaN(n)){e.next=25;break}n<73e3&&(n=86400*(n-25569)),n=Math.round(n),e.next=28;break;case 25:if(n=Date.parse(n)/1e3,!(isNaN(n)||n<0)){e.next=28;break}return e.abrupt("return",[["Invalid 'from'"]]);case 28:if(""!=a&&void 0!==a){e.next=32;break}a=o,e.next=40;break;case 32:if("number"!=typeof a&&isNaN(a)){e.next=37;break}a<73e3&&(a=86400*(a-25569)),a=Math.round(a),e.next=40;break;case 37:if(a=Date.parse(a)/1e3,!(isNaN(a)||a<0)){e.next=40;break}return e.abrupt("return",[["Invalid 'to'"]]);case 40:if(!(a<=n)){e.next=42;break}return e.abrupt("return",[["'to' has to be after 'from'"]]);case 42:return console.log(n,a),u={ticker:r,resolution:t,from:n,to:a,api_key:s,properties:JSON.stringify(f),which:i},c=link+"/excel/candles?"+new URLSearchParams(u).toString(),e.next=47,fetch(c);case 47:if((p=e.sent).ok){e.next=59;break}return e.prev=49,e.next=52,p.text();case 52:return d=e.sent,e.abrupt("return",[[JSON.parse(d).error]]);case 56:return e.prev=56,e.t0=e.catch(49),e.abrupt("return",[["No data"]]);case 59:return e.next=61,p.json();case 61:if(!("message"in(m=e.sent))){e.next=64;break}return e.abrupt("return",[[m.message]]);case 64:if(h=m.data,g=[["Period","Open","High","Low","Close","Volume"]],h.c){e.next=68;break}return e.abrupt("return",[["No data"]]);case 68:if(h.c.constructor===Array)for(k=0;k<h.c.length;k++)g.push([h.t&&h.t[k]?new Date(1e3*h.t[k]):"",h.o&&h.o[k]?h.o[k]:"",h.h&&h.h[k]?h.h[k]:"",h.l&&h.l[k]?h.l[k]:"",h.c[k]?h.c[k]:"",h.v&&h.v[k]?h.v[k]:""]);else g.push([h.t?new Date(1e3*h.t):"",h.o?h.o:"",h.h?h.h:"",h.l?h.l:"",h.c?h.c:"",h.v?h.v:""]);if(!(g.length<2)){e.next=71;break}return e.abrupt("return",[["No data"]]);case 71:return e.abrupt("return",g);case 72:case"end":return e.stop()}}),e,null,[[49,56]])}))),m.apply(this,arguments)}function h(){return h=s(regeneratorRuntime.mark((function e(r,t){var n,a,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:void 0,a=i.length>3&&void 0!==i[3]?i[3]:void 0,e.abrupt("return",d(r,t,n,a,"stock"));case 3:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function g(){return g=s(regeneratorRuntime.mark((function e(r,t){var n,a,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:void 0,a=i.length>3&&void 0!==i[3]?i[3]:void 0,e.abrupt("return",d(r,t,n,a,"forex"));case 3:case"end":return e.stop()}}),e)}))),g.apply(this,arguments)}function k(){return k=s(regeneratorRuntime.mark((function e(r,t){var n,a,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:void 0,a=i.length>3&&void 0!==i[3]?i[3]:void 0,e.abrupt("return",d(r,t,n,a,"crypto"));case 3:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)}function y(){return y=s(regeneratorRuntime.mark((function e(r,t){var n,a,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:void 0,a=i.length>3&&void 0!==i[3]?i[3]:void 0,e.abrupt("return",d(r,t,n,a,"etf"));case 3:case"end":return e.stop()}}),e)}))),y.apply(this,arguments)}function x(){return x=s(regeneratorRuntime.mark((function e(r,t){var n,a,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:void 0,a=i.length>3&&void 0!==i[3]?i[3]:void 0,e.abrupt("return",d(r,t,n,a,"mutual_fund"));case 3:case"end":return e.stop()}}),e)}))),x.apply(this,arguments)}function v(){return v=s(regeneratorRuntime.mark((function e(){var r,t,n,a,i,s,o,u,c,p,l,b,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=f.length>0&&void 0!==f[0]?f[0]:"USD",t=readCookie("finsheet_api_key")){e.next=4;break}return e.abrupt("return",[["Please login using the sidebar"]]);case 4:return n={base_currency:r,api_key:t},a=link+"/excel/forex_all_rates?"+new URLSearchParams(n).toString(),e.next=8,fetch(a);case 8:if((i=e.sent).ok){e.next=20;break}return e.prev=10,e.next=13,i.text();case 13:return s=e.sent,e.abrupt("return",[[JSON.parse(s).error]]);case 17:return e.prev=17,e.t0=e.catch(10),e.abrupt("return",[["No data"]]);case 20:return e.next=22,i.json();case 22:if(!("message"in(o=e.sent))){e.next=25;break}return e.abrupt("return",[[o.message]]);case 25:for(u=o.data,c=[],p=0,l=Object.keys(u);p<l.length;p++)b=l[p],c.push([b,u[b]]);return e.abrupt("return",c);case 29:case"end":return e.stop()}}),e,null,[[10,17]])}))),v.apply(this,arguments)}var w={name:"Name",longName:"Full Name",description:"Description",marketCap:"Market Capitalization",totalSupply:"Total Supply",maxSupply:"Max Supply",circulatingSupply:"Circulating Supply",launchDate:"Launch Date",website:"Website",proofType:"Proof Type"};function _(){return(_=s(regeneratorRuntime.mark((function e(r){var t,n,a,i,s,o,u,c,p,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=readCookie("finsheet_api_key")){e.next=3;break}return e.abrupt("return",[["Please login using the sidebar"]]);case 3:if(r){e.next=5;break}return e.abrupt("return",[["Symbol cannot be empty"]]);case 5:if("string"==typeof r){e.next=7;break}return e.abrupt("return",[["Symbol has to be a string"]]);case 7:if(!r.includes(":")){e.next=9;break}return e.abrupt("return",[["Invalid symbol, make sure it does not include exchange name"]]);case 9:return r=r.toUpperCase(),n=link+"/excel/asset_profile?"+new URLSearchParams({symbol:r,api_key:t,which:"crypto_profile"}).toString(),e.next=14,fetch(n);case 14:if((a=e.sent).ok){e.next=26;break}return e.prev=16,e.next=19,a.text();case 19:return i=e.sent,e.abrupt("return",[[JSON.parse(i).error]]);case 23:return e.prev=23,e.t0=e.catch(16),e.abrupt("return",[["No data"]]);case 26:return e.next=28,a.json();case 28:if(!("message"in(s=e.sent))){e.next=31;break}return e.abrupt("return",[[s.message]]);case 31:for(o=s.data,u=[],c=0,p=Object.keys(w);c<p.length;c++)l=p[c],o[l]&&u.push([w[l],o[l]]);return e.abrupt("return",u);case 35:case"end":return e.stop()}}),e,null,[[16,23]])})))).apply(this,arguments)}var S={assetClass:"Asset Class",aum:"AUM",avgVolume:"Avg Volume",cusip:"CUSIP",description:"Description",domicile:"Domicile",etfCompany:"ETF Issuer",expenseRatio:"Expense Ratio",inceptionDate:"Inception Date",investmentSegment:"Investment Segment",isin:"ISIN",name:"Name",nav:"NAV",navCurrency:"NAV Currency",priceToBook:"P/B",priceToEarnings:"P/E",trackingIndex:"Tracking Index",website:"Website"};function C(){return(C=s(regeneratorRuntime.mark((function e(r){var t,n,a,i,s,o,u,c,p,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=readCookie("finsheet_api_key")){e.next=3;break}return e.abrupt("return",[["Please login using the sidebar"]]);case 3:if(r){e.next=5;break}return e.abrupt("return",[["Symbol cannot be empty"]]);case 5:if("string"==typeof r){e.next=7;break}return e.abrupt("return",[["Symbol has to be a string"]]);case 7:return r=r.toUpperCase(),n=link+"/excel/asset_profile?"+new URLSearchParams({symbol:r,api_key:t,which:"etf_profile"}).toString(),e.next=12,fetch(n);case 12:if((a=e.sent).ok){e.next=24;break}return e.prev=14,e.next=17,a.text();case 17:return i=e.sent,e.abrupt("return",[[JSON.parse(i).error]]);case 21:return e.prev=21,e.t0=e.catch(14),e.abrupt("return",[["No data"]]);case 24:return e.next=26,a.json();case 26:if(!("message"in(s=e.sent))){e.next=29;break}return e.abrupt("return",[[s.message]]);case 29:for(o=s.data.profile,u=[],s.data.symbol&&(u=[["Symbol",s.data.symbol]]),c=0,p=Object.keys(S);c<p.length;c++)l=p[c],o[l]&&u.push([S[l],o[l]]);return e.abrupt("return",u);case 34:case"end":return e.stop()}}),e,null,[[14,21]])})))).apply(this,arguments)}var N={benchmark:"Benchmark",beta:"Beta",category:"Category",description:"Description",expenseRatio:"Expense Ratio",fundFamily:"Fund Family",inceptionDate:"Inception Date",investmentSegment:"Investment Segment",name:"Full Name",totalNav:"Total NAV",turnover:"Turnover"};function R(){return(R=s(regeneratorRuntime.mark((function e(r){var t,n,a,i,s,o,u,c,p,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=readCookie("finsheet_api_key")){e.next=3;break}return e.abrupt("return",[["Please login using the sidebar"]]);case 3:if(r){e.next=5;break}return e.abrupt("return",[["Symbol cannot be empty"]]);case 5:if("string"==typeof r){e.next=7;break}return e.abrupt("return",[["Symbol has to be a string"]]);case 7:return r=r.toUpperCase(),n=link+"/excel/asset_profile?"+new URLSearchParams({symbol:r,api_key:t,which:"mutual_fund_profile"}).toString(),e.next=12,fetch(n);case 12:if((a=e.sent).ok){e.next=24;break}return e.prev=14,e.next=17,a.text();case 17:return i=e.sent,e.abrupt("return",[[JSON.parse(i).error]]);case 21:return e.prev=21,e.t0=e.catch(14),e.abrupt("return",[["No data"]]);case 24:return e.next=26,a.json();case 26:if(!("message"in(s=e.sent))){e.next=29;break}return e.abrupt("return",[[s.message]]);case 29:for(o=s.data.profile,u=[],s.data.symbol&&(u=[["Symbol",s.data.symbol]]),c=0,p=Object.keys(N);c<p.length;c++)l=p[c],o[l]&&u.push([N[l],o[l]]);return e.abrupt("return",u);case 34:case"end":return e.stop()}}),e,null,[[14,21]])})))).apply(this,arguments)}function P(){return(P=s(regeneratorRuntime.mark((function e(r){var t,n,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=readCookie("finsheet_api_key")){e.next=3;break}return e.abrupt("return",[["Please login using the sidebar"]]);case 3:if(r){e.next=5;break}return e.abrupt("return",[[""]]);case 5:if("string"==typeof r){e.next=7;break}return e.abrupt("return",[["Symbol has to be a string"]]);case 7:return r=r.toUpperCase(),n=link+"/excel/latest?"+new URLSearchParams({ticker:r,api_key:t}).toString(),e.next=12,fetch(n);case 12:if((a=e.sent).ok){e.next=24;break}return e.prev=14,e.next=17,a.text();case 17:return i=e.sent,e.abrupt("return",[[JSON.parse(i).error]]);case 21:return e.prev=21,e.t0=e.catch(14),e.abrupt("return",[["No data"]]);case 24:return e.next=26,a.json();case 26:if(!("message"in(s=e.sent))){e.next=29;break}return e.abrupt("return",[[s.message]]);case 29:return e.abrupt("return",[[s.data]]);case 30:case"end":return e.stop()}}),e,null,[[14,21]])})))).apply(this,arguments)}function O(e){var r=readCookie("finsheet_api_key");window.socket=new WebSocket("wss://"+link.slice(8)+"/ws?api_key="+r),window.socket.onopen=function(){console.log("Socket open"),e&&(window.socket.send(JSON.stringify({symbol:e,type:"subscribe"})),window.can_call_streaming=!0)},window.socket.onmessage=function(e){if(window.Should_Update_Streaming){var r=JSON.parse(e.data),t=r.data[0].s;window.OldBigSymbolPriceMap[t]=window.BigSymbolPriceMap[t],window.BigSymbolPriceMap[t]=r.data[0].p}},window.socket.onclose=function(e){console.log(12,e),setTimeout((function(){1e3===e.code?(window.have_not_reconnect_websocket=!1,O()):window.can_call_streaming=!1}),1e3)},window.socket.onerror=function(e){console.log(e),console.error("Socket encountered error: ",e.message,"Closing socket"),window.socket.close()}}function F(){return F=s(regeneratorRuntime.mark((function r(t,n){var a,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Excel.run(function(){var r=s(regeneratorRuntime.mark((function r(t){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:window.have_not_set_interval_change_color&&(window.have_not_set_interval_change_color=!1,setInterval(s(regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(window.Should_Update_Streaming){r.next=2;break}return r.abrupt("return");case 2:return n=t.workbook.worksheets.getActiveWorksheet(),(a=n.getUsedRange(!0)).load("formulas"),a.load("address"),a.load("values"),r.next=9,t.sync().then(s(regeneratorRuntime.mark((function r(){var i,o,u,c,p,l,b,f,d,m,h,g,k,y,x,v,w,_,S,C,N,R;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:i=n.id,o=a.address.split("!")[1].split(":")[0],u=0,c=0,p=0;case 4:if(!(p<o.length)){r.next=12;break}if(isNaN(o[p])){r.next=9;break}return c=colnameToNumber(o.slice(0,p))-1,u=parseInt(o.slice(p))-1,r.abrupt("break",12);case 9:p++,r.next=4;break;case 12:for(l=[],b=[],f=a.formulas,d=a.values,p=0;p<f.length;p++)for(m=0;m<f[0].length;m++)(h=f[p][m]).toLowerCase().startsWith("=fs_streaming(")&&(3===(g=h.split('"')).length?(k=g[1],window.BigSymbolPriceMap[k]&&window.OldBigSymbolPriceMap[k]&&(window.BigSymbolPriceMap[k]>window.OldBigSymbolPriceMap[k]?l.push([u+p,c+m]):window.BigSymbolPriceMap[k]<window.OldBigSymbolPriceMap[k]&&b.push([u+p,c+m]))):(y=i+"@@"+(u+p)+"@@"+(c+m),window.EachCellStreamingValue[y]&&d[p][m]&&(d[p][m]>window.EachCellStreamingValue[y]?l.push([u+p,c+m]):d[p][m]<window.EachCellStreamingValue[y]&&b.push([u+p,c+m])),window.EachCellStreamingValue[y]=d[p][m]));x=0,v=[[l,"#2cbd54"],[b,"#ff6669"]];case 19:if(!(x<v.length)){r.next=33;break}w=v[x],_="",S=e(w[0]);try{for(S.s();!(C=S.n()).done;)g=C.value,N=getExcelColName(g[1]),_+=N.toUpperCase()+(g[0]+1)+":"+N.toUpperCase()+(g[0]+1)+", "}catch(e){S.e(e)}finally{S.f()}if(""!==_&&(_=_.slice(0,_.length-2)),R=n.getRanges(_),!_){r.next=30;break}return R.format.font.color=w[1],r.next=30,t.sync().then(s(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))));case 30:x++,r.next=19;break;case 33:case"end":return r.stop()}}),r)}))));case 9:case"end":return r.stop()}}),r)}))),500));case 1:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()),readCookie("finsheet_api_key")){r.next=4;break}return r.abrupt("return","Please login using the sidebar");case 4:if(t){r.next=6;break}return r.abrupt("return","Symbol cannot be empty");case 6:if("string"==typeof t){r.next=8;break}return r.abrupt("return","Symbol has to be a string");case 8:t=t.toUpperCase(),window.socket&&window.socket.readyState===window.socket.OPEN||!window.have_not_reconnect_websocket?t in window.BigSymbolPriceMap||(a={symbol:t,type:"subscribe"},window.socket.send(JSON.stringify(a)),window.can_call_streaming=!0):O(t),i=setInterval((function(){if(window.can_call_streaming){var e=window.BigSymbolPriceMap[t];n.setResult(e)}else n.setResult("You need a Plus or Pro membership to stream real-time price.")}),500),n.onCanceled=function(){clearInterval(i)};case 12:case"end":return r.stop()}}),r)}))),F.apply(this,arguments)}function I(){return(I=s(regeneratorRuntime.mark((function r(t,n){var a,i,s,o,u,c,p,f,d,m,h,g,k,y,x,v,w,_,S,C,N,R,P,O;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=readCookie("finsheet_api_key")){r.next=3;break}return r.abrupt("return",[["Please login using the sidebar"]]);case 3:if(t){r.next=5;break}return r.abrupt("return",[["Symbol cannot be empty"]]);case 5:if("string"==typeof t){r.next=7;break}return r.abrupt("return",[["Symbol has to be a string"]]);case 7:if(!t.includes(",")&&!t.includes(";")){r.next=9;break}return r.abrupt("return",["Invalid symbol"]);case 9:if(t=t.toUpperCase(),n in l){r.next=12;break}return r.abrupt("return",[["Invalid resolution"]]);case 12:return n in b&&(n=n.toUpperCase()),i={api_key:a,symbol:t,resolution:n,which:"pattern_recognition"},console.log(0,i),s=link+"/excel/technical?"+new URLSearchParams(i).toString(),r.next=18,fetch(s);case 18:if((o=r.sent).ok){r.next=30;break}return r.next=22,o.text();case 22:return u=r.sent,r.prev=23,r.abrupt("return",[[JSON.parse(u).error]]);case 27:return r.prev=27,r.t0=r.catch(23),r.abrupt("return",[["No data"]]);case 30:return r.next=32,o.json();case 32:if(!("message"in(c=r.sent))){r.next=35;break}return r.abrupt("return",[[c.message]]);case 35:r.prev=35,p=c.data,f=[],d=1,m=e(p),r.prev=40,m.s();case 42:if((h=m.n()).done){r.next=52;break}if((g=h.value).patternname&&g.symbol){r.next=46;break}return r.abrupt("continue",50);case 46:for(k=[["Pattern Name",g.patternname]],y=0,x=Object.keys(g);y<x.length;y++)"patternname"!==(v=x[y])&&"symbol"!==v&&k.push([capFirst(v),g[v]]);k.length>d&&(d=k.length),f.push(k);case 50:r.next=42;break;case 52:r.next=57;break;case 54:r.prev=54,r.t1=r.catch(40),m.e(r.t1);case 57:return r.prev=57,m.f(),r.finish(57);case 60:for(w=0;w<f.length;w++)for(_=d-f[w].length,S=0;S<_;S++)f[w].push(["",""]),console.log(f[w].length);if(!(f.length<1)){r.next=63;break}return r.abrupt("return",[["No data"]]);case 63:for(C=[],w=0;w<f[0].length;w++){N=[],R=e(f);try{for(R.s();!(P=R.n()).done;)O=P.value,N=N.concat(O[w])}catch(e){R.e(e)}finally{R.f()}C.push(N)}return console.log(C),r.abrupt("return",C);case 69:return r.prev=69,r.t2=r.catch(35),r.abrupt("return",[["No data"]]);case 72:case"end":return r.stop()}}),r,null,[[23,27],[35,69],[40,54,57,60]])})))).apply(this,arguments)}function U(){return(U=s(regeneratorRuntime.mark((function e(r,t){var n,a,i,s,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=readCookie("finsheet_api_key")){e.next=3;break}return e.abrupt("return",[["Please login using the sidebar"]]);case 3:if(r){e.next=5;break}return e.abrupt("return",[["Symbol cannot be empty"]]);case 5:if("string"==typeof r){e.next=7;break}return e.abrupt("return",[["Symbol has to be a string"]]);case 7:if(!r.includes(",")&&!r.includes(";")){e.next=9;break}return e.abrupt("return",["Invalid symbol"]);case 9:if(r=r.toUpperCase(),t in l){e.next=12;break}return e.abrupt("return",[["Invalid resolution"]]);case 12:return t in b&&(t=t.toUpperCase()),a=link+"/excel/technical?"+new URLSearchParams({api_key:n,symbol:r,resolution:t,which:"support_resistance"}).toString(),e.next=17,fetch(a);case 17:if((i=e.sent).ok){e.next=29;break}return e.next=21,i.text();case 21:return s=e.sent,e.prev=22,e.abrupt("return",[[JSON.parse(s).error]]);case 26:return e.prev=26,e.t0=e.catch(22),e.abrupt("return",[["No data"]]);case 29:return e.next=31,i.json();case 31:if(!("message"in(o=e.sent))){e.next=34;break}return e.abrupt("return",[[o.message]]);case 34:return u=o.data,e.prev=35,e.abrupt("return",u.length<1?[["No data"]]:[u]);case 39:return e.prev=39,e.t1=e.catch(35),e.abrupt("return",[["No data"]]);case 42:case"end":return e.stop()}}),e,null,[[22,26],[35,39]])})))).apply(this,arguments)}function T(){return(T=s(regeneratorRuntime.mark((function e(r,t){var n,a,i,s,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=readCookie("finsheet_api_key")){e.next=3;break}return e.abrupt("return",[["Please login using the sidebar"]]);case 3:if(r){e.next=5;break}return e.abrupt("return",[["Symbol cannot be empty"]]);case 5:if("string"==typeof r){e.next=7;break}return e.abrupt("return",[["Symbol has to be a string"]]);case 7:if(!r.includes(",")&&!r.includes(";")){e.next=9;break}return e.abrupt("return",["Invalid symbol"]);case 9:if(r=r.toUpperCase(),t in l){e.next=12;break}return e.abrupt("return",[["Invalid resolution"]]);case 12:return t in b&&(t=t.toUpperCase()),a=link+"/excel/technical?"+new URLSearchParams({api_key:n,symbol:r,resolution:t,which:"aggregate_indicators"}).toString(),e.next=17,fetch(a);case 17:if((i=e.sent).ok){e.next=29;break}return e.next=21,i.text();case 21:return s=e.sent,e.prev=22,e.abrupt("return",[[JSON.parse(s).error]]);case 26:return e.prev=26,e.t0=e.catch(22),e.abrupt("return",[["No data"]]);case 29:return e.next=31,i.json();case 31:if(!("message"in(o=e.sent))){e.next=34;break}return e.abrupt("return",[[o.message]]);case 34:return u=o.data,e.prev=35,e.abrupt("return",[["Buy",u.technicalAnalysis.count.buy],["Neutral",u.technicalAnalysis.count.neutral],["Sell",u.technicalAnalysis.count.sell],["Aggregate signal",u.technicalAnalysis.signal],["ADX reading",u.trend.adx],["Trending",u.trend.trending.toString()]]);case 39:return e.prev=39,e.t1=e.catch(35),e.abrupt("return",[["No data"]]);case 42:case"end":return e.stop()}}),e,null,[[22,26],[35,39]])})))).apply(this,arguments)}function A(){return A=s(regeneratorRuntime.mark((function r(t,n,a,i){var s,o,u,c,p,f,d,m,h,g,k,y,x,v,w,_,S,C,N,R,P,O,F,I,U=arguments;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=U.length>4&&void 0!==U[4]?U[4]:void 0,o=U.length>5&&void 0!==U[5]?U[5]:[],null==s&&(s=void 0),u=readCookie("finsheet_api_key")){r.next=6;break}return r.abrupt("return",[["Please login using the sidebar"]]);case 6:if(t){r.next=8;break}return r.abrupt("return",[["Symbol cannot be empty"]]);case 8:if("string"==typeof t){r.next=10;break}return r.abrupt("return",[["Symbol has to be a string"]]);case 10:if(!t.includes(",")&&!t.includes(";")){r.next=12;break}return r.abrupt("return",["Invalid symbol"]);case 12:if(t=t.toUpperCase(),n in l){r.next=15;break}return r.abrupt("return",[["Invalid resolution"]]);case 15:if(n in b&&(n=n.toUpperCase()),"string"==typeof a){r.next=18;break}return r.abrupt("return",[["Indicator has to be a string"]]);case 18:if(a=a.toLowerCase(),c=Date.parse(new Date)/1e3,i){r.next=22;break}return r.abrupt("return",[["'from' cannot be empty"]]);case 22:if("number"!=typeof i&&isNaN(i)){r.next=27;break}i<73e3&&(i=86400*(i-25569)),i=Math.round(i),r.next=30;break;case 27:if(i=Date.parse(i)/1e3,!(isNaN(i)||i<0)){r.next=30;break}return r.abrupt("return",[["Invalid 'from'"]]);case 30:if(""!=s&&void 0!==s){r.next=34;break}s=c,r.next=42;break;case 34:if("number"!=typeof s&&isNaN(s)){r.next=39;break}s<73e3&&(s=86400*(s-25569)),s=Math.round(s),r.next=42;break;case 39:if(s=Date.parse(s)/1e3,!(isNaN(s)||s<0)){r.next=42;break}return r.abrupt("return",[["Invalid 'to'"]]);case 42:if(!(s<=i)){r.next=44;break}return r.abrupt("return",[["'to' has to be after 'from'"]]);case 44:p={},r.prev=45,f={},d=e(o);try{for(d.s();!(m=d.n()).done;)h=m.value,f[h[0].toString()]=h[1].toString()}catch(e){d.e(e)}finally{d.f()}p={symbol:t,resolution:n,from:i,to:s,api_key:u,indicator:a,indicator_fields:JSON.stringify(f),which:"technical_indicators"},r.next=55;break;case 52:return r.prev=52,r.t0=r.catch(45),r.abrupt("return",[["Invalid indicator_fields"]]);case 55:return console.log("prepare",p),g=link+"/excel/technical?"+new URLSearchParams(p).toString(),r.next=59,fetch(g);case 59:if((k=r.sent).ok){r.next=71;break}return r.next=63,k.text();case 63:return y=r.sent,r.prev=64,r.abrupt("return",[[JSON.parse(y).error]]);case 68:return r.prev=68,r.t1=r.catch(64),r.abrupt("return",[["No data"]]);case 71:return r.next=73,k.json();case 73:if(x=r.sent,console.log(x),!("message"in x)){r.next=77;break}return r.abrupt("return",[[x.message]]);case 77:if(r.prev=77,(v=x.data).c){r.next=81;break}return r.abrupt("return",[["No data"]]);case 81:for(w={t:1,c:1,o:1,h:1,l:1,v:1,s:1},_=[],S=[["Period","Open","High","Low","Close","Volume"]],C=0,N=Object.keys(v);C<N.length;C++)R=N[C],w[R]||(_.push(R),S[0].push(capFirst(R)));for(P=0;P<v.c.length;P++){O=[v.t&&v.t[P]?new Date(1e3*v.t[P]):"",v.o&&v.o[P]?v.o[P]:"",v.h&&v.h[P]?v.h[P]:"",v.l&&v.l[P]?v.l[P]:"",v.c[P]?v.c[P]:"",v.v&&v.v[P]?v.v[P]:""],F=e(_);try{for(F.s();!(I=F.n()).done;)R=I.value,O.push(v[R]&&null!==v[R][P]&&void 0!==v[R][P]?v[R][P]:"")}catch(e){F.e(e)}finally{F.f()}S.push(O)}if(!(S.length<2)){r.next=88;break}return r.abrupt("return",[["No data"]]);case 88:return console.log(S),r.abrupt("return",S);case 92:return r.prev=92,r.t2=r.catch(77),r.abrupt("return",[["No data"]]);case 95:case"end":return r.stop()}}),r,null,[[45,52],[64,68],[77,92]])}))),A.apply(this,arguments)}function E(){return(E=s(regeneratorRuntime.mark((function e(r){var t,n,a,i,s,o,u,c,p,l,b,f,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=readCookie("finsheet_api_key")){e.next=3;break}return e.abrupt("return",[["Please login using the sidebar"]]);case 3:if(r){e.next=5;break}return e.abrupt("return",[["Symbol cannot be empty"]]);case 5:if("string"==typeof r){e.next=7;break}return e.abrupt("return",[["Symbol has to be a string"]]);case 7:return r=r.toUpperCase(),n=link+"/excel/alternative/esg?"+new URLSearchParams({symbol:r,api_key:t}).toString(),e.next=12,fetch(n);case 12:if((a=e.sent).ok){e.next=24;break}return e.prev=14,e.next=17,a.text();case 17:return i=e.sent,e.abrupt("return",[[JSON.parse(i).error]]);case 21:return e.prev=21,e.t0=e.catch(14),e.abrupt("return",[["No data"]]);case 24:return e.next=26,a.json();case 26:if(!("message"in(s=e.sent))){e.next=29;break}return e.abrupt("return",[[s.message]]);case 29:for(o=s.data,u=[],c=0,p=Object.keys(o);c<p.length;c++)if("data"===(l=p[c]))try{for(b=0,f=Object.keys(o[l]);b<f.length;b++)d=f[b],u.push([capFirst(d.split(/(?=[A-Z])/).join(" ")),o[l][d]])}catch(e){}else u.push([capFirst(l.split(/(?=[A-Z])/).join(" ")),o[l]]);return e.abrupt("return",u);case 33:case"end":return e.stop()}}),e,null,[[14,21]])})))).apply(this,arguments)}function L(){return(L=s(regeneratorRuntime.mark((function r(t,n,a){var i,s,o,u,c,p,l,b,f,d,m,h,g,k,y,x,v,w,_,S;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=readCookie("finsheet_api_key")){r.next=3;break}return r.abrupt("return",[["Please login using the sidebar"]]);case 3:if(t){r.next=5;break}return r.abrupt("return",[["Symbol cannot be empty"]]);case 5:if("string"==typeof t){r.next=7;break}return r.abrupt("return",[["Symbol has to be a string"]]);case 7:if(t=t.toUpperCase(),"string"==typeof n&&["annual","quarterly"].includes(n.toLowerCase())){r.next=10;break}return r.abrupt("return",[["Invalid frequency"]]);case 10:if(a||(a=100),"number"==typeof a){r.next=13;break}return r.abrupt("return",[["Limit has to be a number"]]);case 13:return s=link+"/excel/alternative/earnings_quality?"+new URLSearchParams({symbol:t,api_key:i,freq:n}).toString(),r.next=17,fetch(s);case 17:if((o=r.sent).ok){r.next=29;break}return r.prev=19,r.next=22,o.text();case 22:return u=r.sent,r.abrupt("return",[[JSON.parse(u).error]]);case 26:return r.prev=26,r.t0=r.catch(19),r.abrupt("return",[["No data"]]);case 29:return r.next=31,o.json();case 31:if(!("message"in(c=r.sent))){r.next=34;break}return r.abrupt("return",[[c.message]]);case 34:p=c.data.data,l={period:1,score:1,letterScore:1},b={},f={},d=0,m=e(p),r.prev=40,m.s();case 42:if((h=m.n()).done){r.next=52;break}if((g=h.value).period){r.next=46;break}return r.abrupt("continue",50);case 46:for(d+=1,k=0,y=Object.keys(g);k<y.length;k++)(x=y[k])in l||(b[x]=1),x in f?f[x].push(g.key):x in f||(f[x]=[g.key]);if(d!==a){r.next=50;break}return r.abrupt("break",52);case 50:r.next=42;break;case 52:r.next=57;break;case 54:r.prev=54,r.t1=r.catch(40),m.e(r.t1);case 57:return r.prev=57,m.f(),r.finish(57);case 60:b=["period"].concat(Object.keys(b)).concat(["score",["letterScore"]]),v=[],w=e(b.slice(1,b.length));try{for(w.s();!(_=w.n()).done;)S=_.value,v.push([capFirst(S.split(/(?=[A-Z])/).join(" "))].concat([].concat(f[S]).reverse()))}catch(e){w.e(e)}finally{w.f()}if(!(v.length<1)){r.next=66;break}return r.abrupt("return",[["No data"]]);case 66:return v[0][0]="",r.abrupt("return",v);case 68:case"end":return r.stop()}}),r,null,[[19,26],[40,54,57,60]])})))).apply(this,arguments)}window.OldBigSymbolPriceMap={},window.BigSymbolPriceMap={},window.EachCellStreamingValue={},window.Should_Update_Streaming=!0,window.have_not_reconnect_websocket=!0,window.have_not_add_on_calculated_trigger=!0,window.have_not_set_interval_change_color=!0,window.can_call_streaming=!0,O(),CustomFunctions.associate("FS_EQUITYMETRICS",(function(e,r){return c.apply(this,arguments)})),CustomFunctions.associate("FS_EQUITYFULLFINANCIALS",(function(e,r){return p.apply(this,arguments)})),CustomFunctions.associate("FS_EQUITYCANDLES",(function(e,r){return h.apply(this,arguments)})),CustomFunctions.associate("FS_FOREXCANDLES",(function(e,r){return g.apply(this,arguments)})),CustomFunctions.associate("FS_CRYPTOCANDLES",(function(e,r){return k.apply(this,arguments)})),CustomFunctions.associate("FS_ETFCANDLES",(function(e,r){return y.apply(this,arguments)})),CustomFunctions.associate("FS_MUTUALFUNDCANDLES",(function(e,r){return x.apply(this,arguments)})),CustomFunctions.associate("FS_FOREXALLRATES",(function(){return v.apply(this,arguments)})),CustomFunctions.associate("FS_CRYPTOPROFILE",(function(e){return _.apply(this,arguments)})),CustomFunctions.associate("FS_ETFPROFILE",(function(e){return C.apply(this,arguments)})),CustomFunctions.associate("FS_MUTUALFUNDPROFILE",(function(e){return R.apply(this,arguments)})),CustomFunctions.associate("FS_LATEST",(function(e){return P.apply(this,arguments)})),CustomFunctions.associate("FS_STREAMING",(function(e,r){return F.apply(this,arguments)})),CustomFunctions.associate("FS_PATTERNRECOGNITION",(function(e,r){return I.apply(this,arguments)})),CustomFunctions.associate("FS_SUPPORTRESISTANCE",(function(e,r){return U.apply(this,arguments)})),CustomFunctions.associate("FS_AGGREGATEINDICATORS",(function(e,r){return T.apply(this,arguments)})),CustomFunctions.associate("FS_TECHNICALINDICATORS",(function(e,r,t,n){return A.apply(this,arguments)})),CustomFunctions.associate("FS_ESG",(function(e){return E.apply(this,arguments)})),CustomFunctions.associate("FS_EARNINGSQUALITY",(function(e,r,t){return L.apply(this,arguments)}))}();
//# sourceMappingURL=functions.js.map